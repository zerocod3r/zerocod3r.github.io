{"version":3,"sources":["../../../src/schema/types/derived-types.ts"],"names":["getDerivedTypes","typeComposer","getExtension","Set","deleteFieldsOfDerivedTypes","derivedTypes","getFieldNames","forEach","fieldName","fieldType","getField","type","has","getTypeName","removeField","clearDerivedTypes","schemaComposer","typeName","values","derivedTypeComposer","getAnyTC","delete","_gqType","ObjectTypeComposer","InterfaceTypeComposer","removeInputTypeComposer","setExtension","addDerivedType","derivedTypeName","add"],"mappings":";;;;;AA+BA;;AA/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAmBA,MAAMA,eAAe,GAAG,CAAC;AACvBC,EAAAA;AADuB,CAAD,KAILA,YAAY,CAACC,YAAb,CAA2B,cAA3B,KAA6C,IAAIC,GAAJ,EAJhE;;AAMO,MAAMC,0BAA0B,GAAG,CAAC;AAAEH,EAAAA;AAAF,CAAD,KAA4B;AACpE,QAAMI,YAAY,GAAGL,eAAe,CAAC;AAAEC,IAAAA;AAAF,GAAD,CAApC;AAEAA,EAAAA,YAAY,CAACK,aAAb,GAA6BC,OAA7B,CAAqCC,SAAS,IAAI;AAChD,UAAMC,SAAS,GAAGR,YAAY,CAACS,QAAb,CAAsBF,SAAtB,EAAiCG,IAAnD;;AAEA,QAAIN,YAAY,CAACO,GAAb,CAAiBH,SAAS,CAACI,WAAV,EAAjB,CAAJ,EAA+C;AAC7CZ,MAAAA,YAAY,CAACa,WAAb,CAAyBN,SAAzB;AACD;AACF,GAND;AAOD,CAVM;;;;AAYA,MAAMO,iBAAiB,GAAG,CAAC;AAChCC,EAAAA,cADgC;AAEhCf,EAAAA;AAFgC,CAAD,KAMrB;AACV,QAAMI,YAAY,GAAGL,eAAe,CAAC;AAAEC,IAAAA;AAAF,GAAD,CAApC;;AAEA,OAAK,MAAMgB,QAAX,IAAuBZ,YAAY,CAACa,MAAb,EAAvB,EAA8C;AAC5C,UAAMC,mBAAmB,GAAGH,cAAc,CAACI,QAAf,CAAwBH,QAAxB,CAA5B;AACAF,IAAAA,iBAAiB,CAAC;AAAEC,MAAAA,cAAF;AAAkBf,MAAAA,YAAY,EAAEkB;AAAhC,KAAD,CAAjB;AACAH,IAAAA,cAAc,CAACK,MAAf,CAAsBJ,QAAtB;AACAD,IAAAA,cAAc,CAACK,MAAf,CAAuBF,mBAAD,CAA6BG,OAAnD;AACAN,IAAAA,cAAc,CAACK,MAAf,CAAsBF,mBAAtB;AACD;;AAED,MACElB,YAAY,YAAYsB,kCAAxB,IACAtB,YAAY,YAAYuB,qCAF1B,EAGE;AACAvB,IAAAA,YAAY,CAACwB,uBAAb;AACD;;AAEDxB,EAAAA,YAAY,CAACyB,YAAb,CAA2B,cAA3B,EAA0C,IAAIvB,GAAJ,EAA1C;AACD,CAzBM;;;;AA2BA,MAAMwB,cAAc,GAAG,CAAC;AAC7B1B,EAAAA,YAD6B;AAE7B2B,EAAAA;AAF6B,CAAD,KAMlB;AACV,QAAMvB,YAAY,GAAGL,eAAe,CAAC;AAAEC,IAAAA;AAAF,GAAD,CAApC;AACAA,EAAAA,YAAY,CAACyB,YAAb,CAA2B,cAA3B,EAA0CrB,YAAY,CAACwB,GAAb,CAAiBD,eAAjB,CAA1C;AACD,CATM","sourcesContent":["/**\n * Derived types are types that make sense only when their base type exists\n *\n * Take this node for example:\n * {\n *   internal: { type: 'Foo' },\n *   fields: {\n *     bar: \"string\",\n *   }\n * }\n *\n * It will produce following types:\n * Foo\n * FooFields\n *\n * FooInputFilter\n * FooSortInput\n *\n * FooFieldsInputFilter\n * FooFieldsSortFilter\n * etc\n *\n * Derived types:\n *   Foo: FooFields, FooInputFilter, FooSortInput\n *   FooFields: FooFieldsInputFilter, FooFieldsSortFilter\n *\n * Caveats:\n *   Only types created via inference are marked as derived. So if in the example above\n *   user explicitly defines `FooFields` type (via `createTypes` call) it won't be considered\n *   a derived type\n */\nimport {\n  ObjectTypeComposer,\n  InterfaceTypeComposer,\n  ScalarTypeComposer,\n  SchemaComposer,\n  InputTypeComposer,\n  EnumTypeComposer,\n  UnionTypeComposer,\n} from \"graphql-compose\"\n\ntype AllTypeComposer =\n  | ObjectTypeComposer\n  | InputTypeComposer\n  | EnumTypeComposer\n  | InterfaceTypeComposer\n  | UnionTypeComposer\n  | ScalarTypeComposer\n\nconst getDerivedTypes = ({\n  typeComposer,\n}: {\n  typeComposer: AllTypeComposer\n}): Set<string> => typeComposer.getExtension(`derivedTypes`) || new Set()\n\nexport const deleteFieldsOfDerivedTypes = ({ typeComposer }): void => {\n  const derivedTypes = getDerivedTypes({ typeComposer })\n\n  typeComposer.getFieldNames().forEach(fieldName => {\n    const fieldType = typeComposer.getField(fieldName).type\n\n    if (derivedTypes.has(fieldType.getTypeName())) {\n      typeComposer.removeField(fieldName)\n    }\n  })\n}\n\nexport const clearDerivedTypes = ({\n  schemaComposer,\n  typeComposer,\n}: {\n  schemaComposer: SchemaComposer<any>\n  typeComposer: AllTypeComposer\n}): void => {\n  const derivedTypes = getDerivedTypes({ typeComposer })\n\n  for (const typeName of derivedTypes.values()) {\n    const derivedTypeComposer = schemaComposer.getAnyTC(typeName)\n    clearDerivedTypes({ schemaComposer, typeComposer: derivedTypeComposer })\n    schemaComposer.delete(typeName)\n    schemaComposer.delete((derivedTypeComposer as any)._gqType)\n    schemaComposer.delete(derivedTypeComposer)\n  }\n\n  if (\n    typeComposer instanceof ObjectTypeComposer ||\n    typeComposer instanceof InterfaceTypeComposer\n  ) {\n    typeComposer.removeInputTypeComposer()\n  }\n\n  typeComposer.setExtension(`derivedTypes`, new Set())\n}\n\nexport const addDerivedType = ({\n  typeComposer,\n  derivedTypeName,\n}: {\n  typeComposer: AllTypeComposer\n  derivedTypeName: string\n}): void => {\n  const derivedTypes = getDerivedTypes({ typeComposer })\n  typeComposer.setExtension(`derivedTypes`, derivedTypes.add(derivedTypeName))\n}\n"],"file":"derived-types.js"}