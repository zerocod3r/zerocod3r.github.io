{"version":3,"sources":["../../src/commands/build-javascript.ts"],"names":["buildProductionBundle","program","parentSpan","directory","compilerConfig","Promise","resolve","reject","compiler","run","err","stats","hasErrors","compilation","errors"],"mappings":";;;;;;;AACA;;AACA;;AAGO,MAAMA,qBAAqB,GAAG,OACnCC,OADmC,EAEnCC,UAFmC,KAGsB;AACzD,QAAM;AAAEC,IAAAA;AAAF,MAAgBF,OAAtB;AAEA,QAAMG,cAAc,GAAG,MAAM,uBAC3BH,OAD2B,EAE3BE,SAF2B,EAG1B,kBAH0B,EAI3B,IAJ2B,EAK3B;AAAED,IAAAA;AAAF,GAL2B,CAA7B;AAQA,SAAO,IAAIG,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,QAAQ,GAAG,sBAAQJ,cAAR,CAAjB;AAEAI,IAAAA,QAAQ,CAACC,GAAT,CAAa,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC3B;AACA,UAAID,GAAG,IAAI,CAACC,KAAZ,EAAmB;AACjB,eAAOJ,MAAM,CAACG,GAAD,CAAb;AACD;;AAED,UAAIC,KAAK,CAACC,SAAN,EAAJ,EAAuB;AACrB,eAAOL,MAAM,CAACI,KAAK,CAACE,WAAN,CAAkBC,MAAnB,CAAb;AACD;;AAED,aAAOR,OAAO,CAACK,KAAD,CAAd;AACD,KAXD;AAYD,GAfM,CAAP;AAgBD,CA9BM","sourcesContent":["import { Span } from \"opentracing\"\nimport webpack, { WebpackError } from \"webpack\"\nimport webpackConfig from \"../utils/webpack.config\"\nimport { IProgram } from \"./types\"\n\nexport const buildProductionBundle = async (\n  program: IProgram,\n  parentSpan: Span\n): Promise<webpack.Stats | Error | Array<WebpackError>> => {\n  const { directory } = program\n\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-javascript`,\n    null,\n    { parentSpan }\n  )\n\n  return new Promise((resolve, reject) => {\n    const compiler = webpack(compilerConfig)\n\n    compiler.run((err, stats) => {\n      // stats can only be empty when an error occurs. Adding it to the if makes typescript happy.\n      if (err || !stats) {\n        return reject(err)\n      }\n\n      if (stats.hasErrors()) {\n        return reject(stats.compilation.errors)\n      }\n\n      return resolve(stats)\n    })\n  })\n}\n"],"file":"build-javascript.js"}